<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login / Sign up</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --primary-blue:#1e3a8a;--secondary-blue:#3b82f6;--light-blue:#eff6ff;--white:#ffffff;--dark-text:#1f2937;--gray:#6b7280
    }
    *{box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma, Geneva, Verdana, sans-serif;background:#f8fafc;color:var(--dark-text);min-height:100vh;display:flex;align-items:center;justify-content:center;margin:0}
    
    .auth-card{width:920px;background:var(--white);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.08);display:flex;overflow:hidden; position: relative;}
    
    .left{flex:1;padding:36px;background:linear-gradient(180deg,var(--primary-blue),var(--secondary-blue));color:#fff}
    .left h1{font-size:28px;margin-bottom:8px}
    .left p{opacity:.95}
    .right{flex:1;padding:28px}
    
    .tabs{display:flex;gap:12px;margin-bottom:18px}
    .tab{padding:10px 18px;border-radius:8px;background:#f1f5f9;color:var(--dark-text);cursor:pointer}
    .tab.active{background:var(--light-blue);border:1px solid var(--secondary-blue);font-weight:600}
    
    form{display:flex;flex-direction:column;gap:15px} /* Uniform spacing */
    
    /* UNIFORM INPUT STYLING */
    input {
      width: 100%;
      padding: 12px 15px; /* Comfortable padding */
      border: 1px solid #e6e9ee;
      border-radius: 8px;
      font-size: 14px;
      height: 45px; /* Fixed height for consistency */
    }

    /* EYE ICON INSIDE INPUT */
    .pw-toggle {
      position: relative;
      width: 100%;
    }
    .pw-toggle input {
      padding-right: 40px; /* Space for the eye icon */
    }
    .pw-toggle i {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%); /* Perfectly centered vertically */
      cursor: pointer;
      color: var(--gray);
      z-index: 2;
    }

    .row{display:flex;gap:10px}
    .row .col{flex:1}
    
    .actions{margin-top:8px}
    .btn{background:var(--primary-blue);color:#fff;padding:12px;border-radius:8px;border:none;width:100%;cursor:pointer;font-size:16px;}
    .error{color:#b00020;font-size:14px}
    .success{color:#0b8a1e}

    /* BUFFERING / LOADING OVERLAY */
    .loading-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      display: none; /* Hidden by default */
      justify-content: center;
      align-items: center;
      z-index: 10;
      flex-direction: column;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--light-blue);
      border-top: 4px solid var(--primary-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-text { margin-top: 10px; font-weight: 600; color: var(--primary-blue); }

  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.89.0/dist/umd/supabase.min.js"></script>
</head>
<body>

  <div class="auth-card">
    
    <div id="loadingOverlay" class="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-text">Verifying...</div>
    </div>

    <div class="left">
      <div class="logo"><i class="fa-solid fa-shield-heart" style="font-size:34px"></i></div>
      <h1>Sleeper Cells</h1>
      <p>Securely manage your service requests and bookings. Sign in or create an account to continue.</p>
    </div>
    <div class="right">
      <div class="tabs">
        <div id="tabLogin" class="tab active">Login</div>
        <div id="tabSignup" class="tab">Sign up</div>
      </div>

      <div id="loginPanel">
        <form id="loginForm">
          <input id="loginName" placeholder="Enter your name" required>
          <input id="loginEmail" type="email" placeholder="Enter your mail id" required>
          <div class="pw-toggle">
            <input id="loginPassword" type="password" placeholder="Enter your password" required>
            <i id="loginEye" class="fa-regular fa-eye"></i>
          </div>
          <div class="error" id="loginError"></div>
          <div class="actions"><button class="btn" type="submit">Login</button></div>
        </form>
      </div>

      <div id="signupPanel" style="display:none">
        <form id="signupForm">
          <input id="signupName" placeholder="Enter your name" required>
          <input id="signupEmail" type="email" placeholder="Enter your mail id" required>
          <input id="signupPhone" type="tel" placeholder="Enter your phone number" required>
          <div class="pw-toggle">
            <input id="signupPassword" type="password" placeholder="Create your password" required>
            <i id="signupEye" class="fa-regular fa-eye"></i>
          </div>
          <div class="pw-toggle">
            <input id="signupConfirm" type="password" placeholder="Re-enter your password" required>
            <i id="signupConfirmEye" class="fa-regular fa-eye"></i>
          </div>
          <div class="error" id="signupError"></div>
          <div class="success" id="signupSuccess"></div>
          <div class="actions"><button class="btn" type="submit">Create account</button></div>
        </form>
      </div>
    </div>
  </div>

  <script src="auth.js"></script>
  <script>
    // Loading Utility
    const loader = document.getElementById('loadingOverlay');
    function showLoading() { loader.style.display = 'flex'; }
    function hideLoading() { loader.style.display = 'none'; }

    // Tab switching
    const tabLogin = document.getElementById('tabLogin');
    const tabSignup = document.getElementById('tabSignup');
    const loginPanel = document.getElementById('loginPanel');
    const signupPanel = document.getElementById('signupPanel');
    
    function activate(tab){
      if(tab==='login'){
        tabLogin.classList.add('active');tabSignup.classList.remove('active');
        loginPanel.style.display='block';signupPanel.style.display='none';
      } else {
        tabSignup.classList.add('active');tabLogin.classList.remove('active');
        loginPanel.style.display='none';signupPanel.style.display='block';
      }
    }
    tabLogin.onclick = ()=>activate('login'); tabSignup.onclick = ()=>activate('signup');

    // Password toggle utility
    function toggleEye(inputId, eyeId){
      const inp = document.getElementById(inputId); const eye = document.getElementById(eyeId);
      eye.addEventListener('click', ()=>{
        if(inp.type==='password'){ inp.type='text'; eye.classList.remove('fa-eye'); eye.classList.add('fa-eye-slash'); }
        else { inp.type='password'; eye.classList.remove('fa-eye-slash'); eye.classList.add('fa-eye'); }
      });
    }
    toggleEye('loginPassword','loginEye');
    toggleEye('signupPassword','signupEye');
    toggleEye('signupConfirm','signupConfirmEye');

    // LOGIN HANDLER (With Buffering)
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    
    loginForm.addEventListener('submit', async (e)=>{
      e.preventDefault(); 
      loginError.textContent='';
      
      showLoading(); // START BUFFERING

      const name = document.getElementById('loginName').value.trim();
      const emailEl = document.getElementById('loginEmail');
      const pwEl = document.getElementById('loginPassword');
      const email = emailEl ? emailEl.value.trim() : null;
      const password = pwEl ? pwEl.value : null;

      try{
        const res = await window.auth.signIn(name, email, password);
        
        hideLoading(); // STOP BUFFERING

        if(res.error){ 
          loginError.textContent = res.error.message || res.error; 
          return; 
        }
        // success
        window.location.href = 'homepage.html';
      }catch(err){ 
        hideLoading(); // STOP BUFFERING ON ERROR
        loginError.textContent = err.message || err; 
      }
    });

    // SIGNUP HANDLER (With Buffering)
    const signupForm = document.getElementById('signupForm');
    const signupError = document.getElementById('signupError');
    const signupSuccess = document.getElementById('signupSuccess');

    signupForm.addEventListener('submit', async (e)=>{
      e.preventDefault(); 
      signupError.textContent=''; 
      signupSuccess.textContent='';
      
      showLoading(); // START BUFFERING

      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const phone = document.getElementById('signupPhone').value.trim();
      const pw = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('signupConfirm').value;

      if(pw !== confirm){ 
        hideLoading();
        signupError.textContent='Passwords do not match'; 
        return; 
      }

      try{
        const res = await window.auth.signUp(name, email, phone, pw);
        
        hideLoading(); // STOP BUFFERING

        if(res.error){ 
          signupError.textContent = res.error.message || res.error; 
          return; 
        }
        signupSuccess.textContent = 'Account created â€” please login';
        
        setTimeout(()=>{ 
          activate('login'); 
          document.getElementById('loginEmail').value = email; 
          document.getElementById('loginName').value = name; 
        }, 900);
      }catch(err){ 
        hideLoading(); // STOP BUFFERING ON ERROR
        signupError.textContent = err.message || err; 
      }
    });
  </script>
</body>
</html>